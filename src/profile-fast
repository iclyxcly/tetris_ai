set -e
if [ -z $1 ]; then
    echo "Usage: ./build.sh <filename>"
    exit 1
fi
if [ ! -f $1.cpp ]; then
    echo "File not found!"
    exit 1
fi
g++ -o $1 $1.cpp -Ofast -g -fno-inline -fprofile-generate -std=c++23 -lixwebsocket -lz -lssl -lcrypto
./$1
g++ -o $1 $1.cpp -Ofast -fno-inline -g -fprofile-use -std=c++23 -lixwebsocket -lz -lssl -lcrypto
rm -f $1.gcda
valgrind --tool=callgrind --callgrind-out-file=callgrind.out ./$1
kcachegrind callgrind.out
rm callgrind.out